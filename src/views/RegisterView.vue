<template>
	<section class="flex flex-col sm:flex-row h-screen items-center text-white">
		<header class="hidden lg:block absolute z-10 top-0 left-0 right-0 px-2 mx-auto">
			<svg class="mt-12 ml-8 w-40" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 493.72 105.55" fill="currentColor">
				<path d="M164.45,167.7V133.46l-1.61-7.18h24.63c12.83,0,18.25,5.28,18.25,16.35s-5.57,16.2-18.62,16.2H176.25v8.87l2.64,7.25h-16Zm21-16.72c6.3,0,8.65-2.2,8.65-8.13,0-6.09-2.35-8.58-8.5-8.58h-9.53V151Z" transform="translate(-44.79 -95.44)" />
				<path d="M251.68,164.91l-1.47,10H210.92l1.62-7.18V133.46l-1.62-7.18h38.56l1.54,10-7.26-1.9H224.19v11.87h14.08l5.13-1v9.9l-5.13-1H224.19v12.69H244.5Z" transform="translate(-44.79 -95.44)" />
				<path d="M254.47,150.4c0-16.57,10-25.44,24.33-25.44a54.89,54.89,0,0,1,15.25,2.13L295.81,139l-8.87-4.69a42.13,42.13,0,0,0-7.18-.66c-7.48,0-13.12,4.84-13.12,16.57s5.71,17.37,14.14,17.37a36.57,36.57,0,0,0,6.6-.66l8.65-4.84L294.2,174a42.73,42.73,0,0,1-14.37,2.27C264.73,176.27,254.47,167,254.47,150.4Z" transform="translate(-44.79 -95.44)" />
				<path d="M303.36,158.09V133.46l-1.61-7.18H316.7l-1.54,7.18v25.29c0,6.31,3.67,9.39,10.85,9.39s11.14-3.08,11.14-9.39V133.46l-1.61-7.18H349.1l-1.61,7.18v24.63c0,12.1-7.11,18.33-22.07,18.33S303.36,170.19,303.36,158.09Z" transform="translate(-44.79 -95.44)" />
				<path d="M392.57,164.69,391,175H355.48l1.61-7.18V133.46l-1.61-7.18h14.95l-1.54,7.18v33.06h16.42Z" transform="translate(-44.79 -95.44)" />
				<path d="M444.54,175H430l-.66-6.3-1.1-2.79H406.93l-1.1,2.79-.66,6.3H392.71l18.55-44-1.91-4.62H424.3ZM425,158l-7.41-18.47L410.16,158Z" transform="translate(-44.79 -95.44)" />
				<path d="M494.23,175H477.81l-1-5.94-8.14-12.24h-8.21V167.7l1.69,7.25H447l1.61-7.25V133.46L447,126.28h25.29c12.53,0,18,5.28,18,14.95,0,6.45-3.37,11.37-10.56,13.34Zm-24.7-26.31c5.86,0,9.24-2.28,9.24-7.26s-2.42-7.33-8.29-7.33H460.15v14.59Z" transform="translate(-44.79 -95.44)" />
				<path d="M538.51,164.91,537,175H497.75l1.61-7.18V133.46l-1.61-7.18h38.56l1.54,10-7.26-1.9H511v11.87h14.07l5.13-1v9.9l-5.13-1H511v12.69h20.3Z" transform="translate(-44.79 -95.44)" />
				<path d="M100.84,95.44c-30.95,0-56,23.62-56,52.77S69.89,201,100.84,201s56.06-23.63,56.06-52.77S131.8,95.44,100.84,95.44ZM121.5,171c-3.75,7.89-12,10.94-14.78,11.94-12.51,4.61-27.26,1.21-28.91-3.81a7.39,7.39,0,0,1,.08-4.41,5.75,5.75,0,0,1,3-3.32c.14.14-2.14,2-1.66,3.65a2.57,2.57,0,0,0,1.51,1.45c.36.19.84.42,1.43.66,5.38,2.18,14.45,2.71,20.64-2.84,6.8-6.1,8.25-17.88,2.39-24.84-4-4.79-11.6-7.43-17.56-5.13a12.55,12.55,0,0,0-3.76,2.31l-.59-.9a21.17,21.17,0,0,1-5.6-13.52,18.27,18.27,0,0,1,2.1-9,17.85,17.85,0,0,1,5.72-6.19,25.91,25.91,0,0,1,8.38-3.57A43.12,43.12,0,0,1,104,112.39a60.61,60.61,0,0,1,9.26.63,36.74,36.74,0,0,1,7.45,1.94v14a22.41,22.41,0,0,0-3.67-2,29.16,29.16,0,0,0-4.08-1.47,31.73,31.73,0,0,0-4.18-.87,30.67,30.67,0,0,0-3.94-.28,21,21,0,0,0-4.67.49,12.18,12.18,0,0,0-3.55,1.38,6.93,6.93,0,0,0-2.24,2.12,5,5,0,0,0-.79,2.78,5.25,5.25,0,0,0,.89,3A10,10,0,0,0,97,136.54a26.56,26.56,0,0,0,4,2.34q2.34,1.14,5.28,2.35a59.08,59.08,0,0,1,7.21,3.57,25.74,25.74,0,0,1,5.48,4.27,16.59,16.59,0,0,1,3.5,5.44,19.2,19.2,0,0,1,1.22,7.12A23.66,23.66,0,0,1,121.5,171ZM104,159.47c-.88-3.95-2.7-6.88-5.42-8.68a9.61,9.61,0,0,0-7.36-1.91,8.78,8.78,0,0,0-3.37,1.3l-3-2.75c.92-1.06,4.06-4,10-2.87a16,16,0,0,1,12.71,17.86h0a28,28,0,0,1-2.41,8.09l-1-.19A30.88,30.88,0,0,0,104,159.47Zm-18.47-7.63a6.81,6.81,0,0,0,.81,1.1A8.89,8.89,0,0,1,101.71,159a8.76,8.76,0,0,1-1,4.08l.49.23c2,.86-2.81,2-2.13,3.58s2.72,3.68,1.75,4.36c0,0-7.18,1.45-7.76-1.84a5.26,5.26,0,0,1,0-1.53c.34-2.6,2.38-4.63,1-4.87-.93-.17-2.07,2.32-3.13,4.66-.83,1.83-1.61,3.57-2.21,3.9-1.36.75-10.57,7-8.24,2.49s2.81-10.57,2.81-10.57l1.47-.82,2.7-1.51H82.88s-1.65,3.78-1.26,4.85-2.6,1.55-1.55-1,2-8.73,2-8.73S83.55,148.35,85.49,151.84Z" transform="translate(-44.79 -95.44)" />
			</svg>
		</header>

		<div class="w-full lg:max-w-full md:w-1/2 xl:w-1/3 h-screen px-6 lg:px-16 xl:px-12 flex items-center justify-center">
			<div class="w-full h-100">
				<svg class="block w-52 mb-12 lg:mb-0 lg:hidden lg:mt-12 lg:ml-8 lg:w-40" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 493.72 105.55" fill="currentColor">
					<path d="M164.45,167.7V133.46l-1.61-7.18h24.63c12.83,0,18.25,5.28,18.25,16.35s-5.57,16.2-18.62,16.2H176.25v8.87l2.64,7.25h-16Zm21-16.72c6.3,0,8.65-2.2,8.65-8.13,0-6.09-2.35-8.58-8.5-8.58h-9.53V151Z" transform="translate(-44.79 -95.44)" />
					<path d="M251.68,164.91l-1.47,10H210.92l1.62-7.18V133.46l-1.62-7.18h38.56l1.54,10-7.26-1.9H224.19v11.87h14.08l5.13-1v9.9l-5.13-1H224.19v12.69H244.5Z" transform="translate(-44.79 -95.44)" />
					<path d="M254.47,150.4c0-16.57,10-25.44,24.33-25.44a54.89,54.89,0,0,1,15.25,2.13L295.81,139l-8.87-4.69a42.13,42.13,0,0,0-7.18-.66c-7.48,0-13.12,4.84-13.12,16.57s5.71,17.37,14.14,17.37a36.57,36.57,0,0,0,6.6-.66l8.65-4.84L294.2,174a42.73,42.73,0,0,1-14.37,2.27C264.73,176.27,254.47,167,254.47,150.4Z" transform="translate(-44.79 -95.44)" />
					<path d="M303.36,158.09V133.46l-1.61-7.18H316.7l-1.54,7.18v25.29c0,6.31,3.67,9.39,10.85,9.39s11.14-3.08,11.14-9.39V133.46l-1.61-7.18H349.1l-1.61,7.18v24.63c0,12.1-7.11,18.33-22.07,18.33S303.36,170.19,303.36,158.09Z" transform="translate(-44.79 -95.44)" />
					<path d="M392.57,164.69,391,175H355.48l1.61-7.18V133.46l-1.61-7.18h14.95l-1.54,7.18v33.06h16.42Z" transform="translate(-44.79 -95.44)" />
					<path d="M444.54,175H430l-.66-6.3-1.1-2.79H406.93l-1.1,2.79-.66,6.3H392.71l18.55-44-1.91-4.62H424.3ZM425,158l-7.41-18.47L410.16,158Z" transform="translate(-44.79 -95.44)" />
					<path d="M494.23,175H477.81l-1-5.94-8.14-12.24h-8.21V167.7l1.69,7.25H447l1.61-7.25V133.46L447,126.28h25.29c12.53,0,18,5.28,18,14.95,0,6.45-3.37,11.37-10.56,13.34Zm-24.7-26.31c5.86,0,9.24-2.28,9.24-7.26s-2.42-7.33-8.29-7.33H460.15v14.59Z" transform="translate(-44.79 -95.44)" />
					<path d="M538.51,164.91,537,175H497.75l1.61-7.18V133.46l-1.61-7.18h38.56l1.54,10-7.26-1.9H511v11.87h14.07l5.13-1v9.9l-5.13-1H511v12.69h20.3Z" transform="translate(-44.79 -95.44)" />
					<path d="M100.84,95.44c-30.95,0-56,23.62-56,52.77S69.89,201,100.84,201s56.06-23.63,56.06-52.77S131.8,95.44,100.84,95.44ZM121.5,171c-3.75,7.89-12,10.94-14.78,11.94-12.51,4.61-27.26,1.21-28.91-3.81a7.39,7.39,0,0,1,.08-4.41,5.75,5.75,0,0,1,3-3.32c.14.14-2.14,2-1.66,3.65a2.57,2.57,0,0,0,1.51,1.45c.36.19.84.42,1.43.66,5.38,2.18,14.45,2.71,20.64-2.84,6.8-6.1,8.25-17.88,2.39-24.84-4-4.79-11.6-7.43-17.56-5.13a12.55,12.55,0,0,0-3.76,2.31l-.59-.9a21.17,21.17,0,0,1-5.6-13.52,18.27,18.27,0,0,1,2.1-9,17.85,17.85,0,0,1,5.72-6.19,25.91,25.91,0,0,1,8.38-3.57A43.12,43.12,0,0,1,104,112.39a60.61,60.61,0,0,1,9.26.63,36.74,36.74,0,0,1,7.45,1.94v14a22.41,22.41,0,0,0-3.67-2,29.16,29.16,0,0,0-4.08-1.47,31.73,31.73,0,0,0-4.18-.87,30.67,30.67,0,0,0-3.94-.28,21,21,0,0,0-4.67.49,12.18,12.18,0,0,0-3.55,1.38,6.93,6.93,0,0,0-2.24,2.12,5,5,0,0,0-.79,2.78,5.25,5.25,0,0,0,.89,3A10,10,0,0,0,97,136.54a26.56,26.56,0,0,0,4,2.34q2.34,1.14,5.28,2.35a59.08,59.08,0,0,1,7.21,3.57,25.74,25.74,0,0,1,5.48,4.27,16.59,16.59,0,0,1,3.5,5.44,19.2,19.2,0,0,1,1.22,7.12A23.66,23.66,0,0,1,121.5,171ZM104,159.47c-.88-3.95-2.7-6.88-5.42-8.68a9.61,9.61,0,0,0-7.36-1.91,8.78,8.78,0,0,0-3.37,1.3l-3-2.75c.92-1.06,4.06-4,10-2.87a16,16,0,0,1,12.71,17.86h0a28,28,0,0,1-2.41,8.09l-1-.19A30.88,30.88,0,0,0,104,159.47Zm-18.47-7.63a6.81,6.81,0,0,0,.81,1.1A8.89,8.89,0,0,1,101.71,159a8.76,8.76,0,0,1-1,4.08l.49.23c2,.86-2.81,2-2.13,3.58s2.72,3.68,1.75,4.36c0,0-7.18,1.45-7.76-1.84a5.26,5.26,0,0,1,0-1.53c.34-2.6,2.38-4.63,1-4.87-.93-.17-2.07,2.32-3.13,4.66-.83,1.83-1.61,3.57-2.21,3.9-1.36.75-10.57,7-8.24,2.49s2.81-10.57,2.81-10.57l1.47-.82,2.7-1.51H82.88s-1.65,3.78-1.26,4.85-2.6,1.55-1.55-1,2-8.73,2-8.73S83.55,148.35,85.49,151.84Z" transform="translate(-44.79 -95.44)" />
				</svg>
				
				<h1 class="mb-6 text-3xl">
					Create Your Speculare Account
				</h1>

				<div class="mt-6">
					<div class="form-control w-full">
						<label class="label">
							<span class="label-text">What is your email?</span>
						</label>
						<input
							ref="emailField" autocomplete="on" name="email" type="email"
							placeholder="john.doe@speculare.cloud" 
							class="input input-bordered w-full bg-base-300" :class="(emailEmpty || !emailValid) ? 'input-error' : 'input-success'"
							v-model="emailAddr" @input="checkEmail" style="font-size: 0.875rem;">
						<div class="input-error mt-2 text-error" :class="(emailEmpty || !emailValid) ? 'block' : 'hidden'">
							<span v-if="emailEmpty">Email address cannot be empty.</span>
							<span v-if="!emailEmpty && !emailValid">Email is not valid.</span>
						</div>
					</div>

					<button @click="sendRequest" class="btn btn-primary flex w-full justify-center items-center mt-6 text-primary-content">
						<div class="flex mr-2">
							<svg v-if="!requestLoading" class="w-4 h-4 min-h-[1em] min-w-[1em] align-middle" fill="currentColor" viewBox="0 0 24 24">
								<path d="M7.5,5.6L5,7L6.4,4.5L5,2L7.5,3.4L10,2L8.6,4.5L10,7L7.5,5.6M19.5,15.4L22,14L20.6,16.5L22,19L19.5,17.6L17,19L18.4,16.5L17,14L19.5,15.4M22,2L20.6,4.5L22,7L19.5,5.6L17,7L18.4,4.5L17,2L19.5,3.4L22,2M13.34,12.78L15.78,10.34L13.66,8.22L11.22,10.66L13.34,12.78M14.37,7.29L16.71,9.63C17.1,10 17.1,10.65 16.71,11.04L5.04,22.71C4.65,23.1 4,23.1 3.63,22.71L1.29,20.37C0.9,20 0.9,19.35 1.29,18.96L12.96,7.29C13.35,6.9 14,6.9 14.37,7.29Z" />
							</svg>
							<svg
								v-if="requestLoading" class="animate-spin -ml-1 mr-3 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none"
								viewBox="0 0 24 24">
								<circle
									class="opacity-25" cx="12" cy="12" r="10"
									stroke="currentColor" stroke-width="4" />
								<path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" />
							</svg>
						</div>
						<span v-if="!requestLoading">Get started!</span>
						<span v-if="requestLoading">Sending...</span>
					</button>

					<div class="flex items-center text-base-content mt-2">
						<svg class="w-8 h-8 align-top mr-2" style="fill: currentcolor;" viewBox="0 0 24 24">
							<path d="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z" />
						</svg>
						<p class="text-xs">
							To learn more about how we protect your personal data and how to exercise your rights, please visit our <a class="text-info" href="#">Privacy Policy</a>.
						</p>
					</div>
				</div>

				<p class="text-base-content text-center mt-12">
					Already have an account? <router-link key="login" :to="{ name: 'Login' }" class="text-info">
						Log in
					</router-link>
				</p>
			</div>
		</div>

		<div class="bg-primary hidden sm:block w-full md:w-1/2 xl:w-2/3 h-screen">
			<img src="https://source.unsplash.com/random" class="w-full h-full object-cover" loading="lazy">
		</div>
	</section>
</template>

<script>
export default {
	name: 'Register',

	data () {
		return {
			emailAddr: "",
			emailEmpty: false,
			emailValid: true,
			requestLoading: false,
		}
	},

	methods: {
		validateEmail: function(email) {
			return String(email)
				.toLowerCase()
				.match(
					/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
				);
		},
		checkEmail: function() {
			this.emailEmpty = this.emailAddr == "";
			this.emailValid = this.validateEmail(this.emailAddr);
		},
		sendRequest: async function() {
			// If the email is not valid, don't send
			if (this.requestLoading || !this.validateEmail(this.emailAddr)) return;

			this.requestLoading = true;
			console.log("Sending request for email: ", this.emailAddr);
			await this.$http.post(this.$authBase + "/api/rsso", {
				email: this.emailAddr
			}).then((resp) => {
				console.log("Success", resp);
				// Redirect to the wait page
				this.$router.replace({ name: 'Wait' });
			}).catch((err) => {
				console.log("Error", err);
			}).finally(() => {
				this.requestLoading = false;
			});
		}
	}
}
</script>
